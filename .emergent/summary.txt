<analysis>
The AI engineer successfully developed a combat sports judging tool from initial requirements. Key achievements include implementing a custom scoring algorithm, a 10-Point-Must system with gate checks and dynamic thresholds, and real-time event logging to Firebase. The UI features operator and judge panels, dynamic button coloring, accumulating control timers, and multi-fight event management with round and fight navigation. Significant effort was spent on debugging Firebase integration and refining scoring logic based on detailed user feedback. The final stages involved initiating an extensive advanced features list, creating foundational components and routes for judge login, explainability cards, fighter memory logs, and offline sync. The AI's last action was creating , indicating ongoing work on advanced features.
</analysis>

<product_requirements>
The goal is to create a combat sports judging tool with two main screens:
1.  **Operator Panel**: For fight data operators to log events in real-time. Features large tap buttons for events like KD (with severity: Flash, Hard, Near Finish), SS (Head, Body, Leg), Takedown, Submission Attempt (depth picker), Pass, Reversal, and Control Timer Start/Stop. Includes round timer (later replaced by control timers) and status bar. Events auto-write to Firestore with fighter, event type, timestamp, and bout ID. Buttons change color (Red/Blue) based on selected fighter. Round navigation buttons (forward/back) are present.
2.  **Judge Panel**: View-only scoring screen displaying computed round scores, subscores for metrics (KD, ISS/SS, TDQ, SUBQ, GCQ, OC, AGG, RP, TSR), and a Confirm Round button. Real-time data pull from Firestore.
**Scoring Algorithm**: A custom model (FightJudge) is used, not 10-Point-Must for computation initially. Subscores (0-10 continuous) are calculated with diminishing returns. Final Round Score is an importance-weighted blend (0-200 range, later 1-1000). Official 10-Point-Must labels are mapped from score differentials (Δ). This was refined multiple times:
    *   Initial mapping: Δ < 8.0 → “close 10-9”, 8.0–17.9 → “clear 10-9”, 18.0–31.9 → “10-8-level”, ≥32.0 → “10-7-level”.
    *   Revised to incorporate gate checks (FinishThreat, ControlDom, MultiCatDom) and specific thresholds for 10-8 and 10-7 based on TypeScript pseudocode. Fouls are applied post-mapping. Score output 7-10.
    *   Final scoring differential thresholds: 10-10 for exact match, 10-9 for 1-600 diff, 10-8 for 601-900, 10-7 for 901-1000. Strength scores scaled 1-1000.
**Advanced Features (Requested, partially implemented)**: Memory log, Shadow-Judging/Training Mode, Offline-First + Reconcile, Explainability Cards, Judge Profile Sign-in, Discrepancy Flags, Per-Promotion Tuning, Distraction-Free Mode, Uncertainty Bands, Accessibility, Security & Audit (cryptographic signature, WORM logs).
**UI/UX**: Neutral dark background, bold readable fonts, responsive for tablets, uses Shadcn UI components, modern button styles, FontAwesome/lucid-react icons, sonner for toasts. No universal transitions, glass-morphism effects.
**Technical**: React frontend, FastAPI backend, MongoDB database. Firebase Firestore for event logging and real-time updates.

</product_requirements>

<key_technical_concepts>
-   **Full-Stack Application**: React (frontend), FastAPI (backend), MongoDB (database).
-   **Real-time Database**: Google Firebase Firestore for event logging and synchronization.
-   **Custom Scoring Algorithm**: Detailed formula for subscores and composite scores (0-1000 scale).
-   **10-Point-Must System**: Dynamic mapping of composite scores to 10-9, 10-8, 10-7, 10-10 with gate checks.
-   **Shadcn UI**: Component library for consistent and accessible UI.
-   **Offline-First**: Planned local data queue with IndexedDB (IndexedDB).
-   **Event-Driven Logging**: Real-time logging of fight events with timestamps.
-   **Control Timers**: Accumulating per-fighter control time.
</key_technical_concepts>

<code_architecture>


-   **/app/backend/server.py**: Main FastAPI application.
    -   **Importance**: Handles API endpoints for event logging, score computation, and data persistence.
    -   **Changes**: Initially implemented custom scoring. Later modified to incorporate the detailed 10-Point-Must logic, gate checks, and dynamic thresholds based on provided TypeScript pseudocode. Updated KD severity values and various subscore weights. , , and  functions were added/modified to align with TypeScript implementation, including 1-1000 strength score scaling and new differential thresholds.
-   **/app/frontend/src/firebase.js**: Firebase initialization and Firestore instance.
    -   **Importance**: Connects the frontend to Firebase Firestore for real-time data.
    -   **Changes**: Updated to use  and  for compatibility.
-   **/app/frontend/src/index.js**: Entry point for the React application.
    -   **Importance**: Renders the main  component.
    -   **Changes**: Wrapped  with  component for displaying notifications.
-   **/app/frontend/src/App.js**: Main React component, handles routing.
    -   **Importance**: Orchestrates the application's different views and navigations.
    -   **Changes**: Added routes for , , , , , and . Integrated placeholder routes for advanced features.
-   **/app/frontend/src/components/BoutSetup.jsx**: Component for initial bout configuration.
    -   **Importance**: Allows users to set up basic fight details.
    -   **Changes**: Updated to use Firebase compat API. (Initial creation).
-   **/app/frontend/src/components/OperatorPanel.jsx**: Panel for real-time event logging.
    -   **Importance**: Core UI for data operators.
    -   **Changes**: Implemented event buttons (KD, SS, TD, SUB, Pass, Reversal), accumulating control timers, dynamic button coloring (red/blue), round navigation (forward/back), and initial offline sync capabilities. Uses Firebase compat API.
-   **/app/frontend/src/components/JudgePanel.jsx**: View-only scoring panel.
    -   **Importance**: Displays computed scores and judging cards.
    -   **Changes**: Updated to display 10-Point-Must cards, subscores. Navigation buttons (back to list, next fight) were added and debugged. Integrated . Uses Firebase compat API.
-   **/app/frontend/src/components/EventSetup.jsx**: Component for managing multiple events/fights.
    -   **Importance**: Allows users to pre-fill up to 15 fights with event details and rounds (3 or 5).
    -   **Changes**: Initial creation and form handling.
-   **/app/frontend/src/components/FightList.jsx**: Displays a list of created fights.
    -   **Importance**: Serves as the main navigation hub after event setup, allowing selection of fights.
    -   **Changes**: Initial creation. Fixed Firestore query issue related to  clause.
-   **/app/frontend/src/components/JudgeLogin.jsx**: Judge authentication/profile entry point.
    -   **Importance**: Foundation for judge profiles and security features.
    -   **Changes**: Initial creation.
-   **/app/frontend/src/utils/advancedFeatures.js**: Utility for advanced feature integration.
    -   **Importance**: Placeholder/helper for future advanced features.
    -   **Changes**: Initial creation.
-   **/app/frontend/src/components/ExplainabilityCard.jsx**: Component to explain judging decisions.
    -   **Importance**: Provides transparency for score cards (e.g., Why 10-8?).
    -   **Changes**: Initial creation and integration into JudgePanel.
-   **/app/frontend/src/components/FighterMemoryLog.jsx**: Component for tracking fighter tendencies and stats.
    -   **Importance**: Enables historical analysis of fighter performance.
    -   **Changes**: Initial creation.
-   **/app/frontend/src/components/ShadowJudgingMode.jsx**: Component for a training/calibration mode.
    -   **Importance**: Allows judges to practice scoring against hidden official cards.
    -   **Changes**: Initial creation.
-   **/app/FIREBASE_SETUP.md**: Markdown file with Firebase setup instructions.
    -   **Importance**: Guides the user on configuring Firebase security rules.
    -   **Changes**: Initial creation.

</code_architecture>

<pending_tasks>
-   **Advanced Features**:
    -   Full implementation of Judge Profile Sign-in (beyond initial component creation).
    -   Complete Shadow-Judging / Training Mode (metrics, hidden cards).
    -   Full implementation of Offline-First + Reconcile (IndexedDB logic).
    -   Detailed Explainability Cards (populating bullets/clips).
    -   Memory log of fighter tendencies and past stats.
    -   Discrepancy Flags for Review.
    -   Per-Promotion Tuning Profiles.
    -   Distraction-Free Mode.
    -   Uncertainty Bands.
    -   Accessibility & Focus (Large-type mode, high contrast, audible cues).
    -   Security & Audit (cryptographic signatures, WORM logs).
</pending_tasks>

<current_work>
The system is a combat sports judging tool with a React frontend and FastAPI backend, using Firebase Firestore for data. The core functionality of event logging (KD, SS, TD, SUB, Pass, Reversal) on the Operator Panel, real-time score calculation, and display on the Judge Panel is operational. It includes accumulating control timers per fighter, dynamic button coloring, and a multi-fight event management system with sequential fight navigation. The scoring system calculates subscores and composite strength scores (1-1000 scale) and maps them to official 10-Point-Must cards (10-10, 10-9, 10-8, 10-7) using precise delta thresholds and gate checks. The AI has just started implementing a large set of advanced features, creating initial components and routes for Judge Login, Explainability Cards, Fighter Memory Log, and basic offline sync. The last action was the creation of .
</current_work>

<optional_next_step>
Continue building the remaining advanced features as per user's request.
</optional_next_step>

